I"G5<p>Each component group keeps track of a list of entities that have all the required <a href="/development-guide/entities-components/">components</a>.</p>

<p><img src="/images/media/ecs-big-picture-w-compgroup.png" alt="" /></p>

<p>The engine automatically updates this list every time that:</p>

<ul>
  <li>A new entity is added to the engine</li>
  <li>An entity is removed from the engine</li>
  <li>An entity in the engine adds a new component</li>
  <li>An entity in the engine removes a component</li>
</ul>

<blockquote>
  <p>Note: Only entities that are added to the engine are eligible for component groups. Entities that have been created but not added to the engine, or that have been removed from the engine, aren’t listed in any group.</p>
</blockquote>

<p>After the group is created, you don’t need to add or remove entities manually from it, the engine takes care of that.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">myGroup</span> <span class="o">=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">getComponentGroup</span><span class="p">(</span><span class="nx">Transform</span><span class="p">)</span>
</code></pre></div></div>

<p><a href="/development-guide/systems/">Systems</a> typically iterate over the entities in these groups in their update method, performing the same operations on each. Having a predefined group of valid entities is a great way to save resources, specially for functions that run on every frame like <code class="language-plaintext highlighter-rouge">update()</code>. If on every frame your system would have to iterate over every single entity in the scene looking for the ones it needs, that would be very time consuming.</p>

<p>You can access the entities in a component group in the following way: if the group name is <code class="language-plaintext highlighter-rouge">myGroup</code>, calling <code class="language-plaintext highlighter-rouge">myGroup.entities</code> returns an array containing all the entities in it.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">myGroup</span> <span class="o">=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">getComponentGroup</span><span class="p">(</span><span class="nx">Transform</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entity</span> <span class="k">of</span> <span class="nx">myGroup</span><span class="p">.</span><span class="nx">entities</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Note: Keep in mind that component groups take up space in the local memory of the player’s machine. Usually, the benefit in speed you get from having a group is a tradeoff that is well worth it. However, for cases where you’d have a large group that you don’t access all that often, it might be better to not have one.</p>
</blockquote>

<h2 id="required-components">Required components</h2>

<p>When creating a component group, specify what components need to be present in every entity that’s added to the group. You can list as many components as you want, the component group will only accept entities that have <strong>all</strong> of the listed components.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">myGroup</span> <span class="o">=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">getComponentGroup</span><span class="p">(</span><span class="nx">Transform</span><span class="p">,</span> <span class="nx">Physics</span><span class="p">,</span> <span class="nx">NextPosition</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>Tip: If your scene includes entities that have all the required components but that don’t need to be in your component group, create a custom component to act as a <a href="/development-guide/entities-components/#components-as-flags">flag</a>. This component doesn’t need to have any properties in it. Add this component to the entities that you want the component group to handle.</p>
</blockquote>

<h2 id="use-component-groups-in-a-system">Use component groups in a system</h2>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">myGroup</span> <span class="o">=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">getComponentGroup</span><span class="p">(</span><span class="nx">Transform</span><span class="p">,</span> <span class="nx">Physics</span><span class="p">)</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">PhysicsSystem</span> <span class="k">implements</span> <span class="nx">ISystem</span> <span class="p">{</span>
  <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entity</span> <span class="k">of</span> <span class="nx">myGroup</span><span class="p">.</span><span class="nx">entities</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">position</span> <span class="o">=</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(</span><span class="nx">Transform</span><span class="p">).</span><span class="nx">Position</span>
      <span class="kd">const</span> <span class="nx">vel</span> <span class="o">=</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(</span><span class="nx">Physics</span><span class="p">).</span><span class="nx">velocity</span>
      <span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">vel</span><span class="p">.</span><span class="nx">x</span>
      <span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">vel</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">position</span><span class="p">.</span><span class="nx">z</span> <span class="o">+=</span> <span class="nx">vel</span><span class="p">.</span><span class="nx">z</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, <code class="language-plaintext highlighter-rouge">PhysicsSystem</code> iterates over the entities in <code class="language-plaintext highlighter-rouge">myGroup</code> as part of the <code class="language-plaintext highlighter-rouge">update()</code> function, that is executed on every frame of the game loop.</p>

<ul>
  <li>
    <p>If the scene has several <em>ball</em> entities, each with a <code class="language-plaintext highlighter-rouge">Position</code> and a <code class="language-plaintext highlighter-rouge">Physics</code> component, then they will be included in <code class="language-plaintext highlighter-rouge">myGroup</code>. <code class="language-plaintext highlighter-rouge">PhysicsSystem</code> will then update their position on every frame.</p>
  </li>
  <li>
    <p>If your scene also has other entities like a <em>hoop</em> and a <em>scoreBoard</em> that only have a <code class="language-plaintext highlighter-rouge">Physics</code> component, then they won’t be in <code class="language-plaintext highlighter-rouge">myGroup</code> and won’t be affected by <code class="language-plaintext highlighter-rouge">PhysicsSystem</code>.</p>
  </li>
</ul>

<blockquote>
  <p>Note: The <code class="language-plaintext highlighter-rouge">engine.getComponentGroup()</code> is an expensive function to process, it should never be used inside the <code class="language-plaintext highlighter-rouge">update</code> of a system, as that would create a new group on every frame. When regularly checking the entities in a group, refer to an already created group, as in the example above. Once created, compnent groups are updated as entities and components are added and removed from the engine, so there’s no need to redeclare or update these groups.</p>
</blockquote>

<h2 id="dealing-with-the-entities">Dealing with the entities</h2>

<p>The <code class="language-plaintext highlighter-rouge">entities</code> array of a component group contains elements of type <code class="language-plaintext highlighter-rouge">IEntity</code>, which is identical to <code class="language-plaintext highlighter-rouge">Entity</code>, but not recogized by Typescript as the same type. If a function expects an input of type <code class="language-plaintext highlighter-rouge">Entity</code>, you can simply force the argument’s type with <code class="language-plaintext highlighter-rouge">as Entity</code>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">myGroup</span> <span class="o">=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">getComponentGroup</span><span class="p">(</span><span class="nx">Billboard</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entity</span> <span class="k">of</span> <span class="nx">myGroup</span><span class="p">.</span><span class="nx">entities</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">addLabel</span><span class="p">(</span><span class="nx">entity</span> <span class="k">as</span> <span class="nx">Entity</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">addLabel</span><span class="p">(</span><span class="nx">entity</span><span class="p">:</span> <span class="nx">Entity</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">label</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Entity</span><span class="p">()</span>
  <span class="nx">label</span><span class="p">.</span><span class="nx">setParent</span><span class="p">(</span><span class="nx">entity</span><span class="p">)</span>
  <span class="nx">label</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Transform</span><span class="p">({</span>
      <span class="na">position</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
      <span class="na">scale</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">})</span>
  <span class="p">)</span>
  <span class="nx">label</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="k">new</span> <span class="nx">TextShape</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">uuid</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="all-entities">All entities</h2>

<p>You can access the full list of entities that have been added to the engine, regardless of what components they have, through <code class="language-plaintext highlighter-rouge">engine.entities</code>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">engine</span><span class="p">.</span><span class="nx">entities</span>
</code></pre></div></div>

<h2 id="change-a-component-group-while-iterating">Change a component group while iterating</h2>

<p>Component groups are mutable. You shouldn’t modify the component group while you’re iterating over it, because that could have unwanted consequences.</p>

<p>For example, if you iterate over a component group to remove each entity from the engine, the act of removing an entity displaces the other entities in the array, which can lead to some entities being skipped.</p>

<p>To overcome this problem, use the following code to remove all entities from the engine:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="nx">myGroup</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">engine</span><span class="p">.</span><span class="nx">removeEntity</span><span class="p">(</span><span class="nx">myGroup</span><span class="p">.</span><span class="nx">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div></div>
:ET