I"/S<p>Once you have <a href="https://docs.decentraland.org/#create-your-first-scene">built a new scene</a> or downloaded a <a href="https://github.com/decentraland-scenes/Awesome-Repository#examples">scene example</a> you can preview it locally.</p>

<h2 id="before-you-begin">Before you begin</h2>

<p>Please make sure you first install the CLI tools by running the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">-g</span> decentraland
</code></pre></div></div>

<p>See the <a href="/development-guide/installation-guide/">Installation Guide</a> for more details instructions.</p>

<h2 id="preview-a-scene">Preview a scene</h2>

<p>To preview a scene run the following command on the scene’s main folder:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcl start
</code></pre></div></div>

<p>Any dependencies that are missing are installed and then the CLI opens the scene in a new browser tab automatically. It creates a local web server in your system and points the web browser tab to this local address.</p>

<p>Every time you make changes to the scene, the preview reloads and updates automatically, so there’s no need to run the command again.</p>

<blockquote>
  <p>Note: Some scenes depend on an external server to store a shared state for all players in the scene. When previewing one of these scenes, you’ll likely have to also run the server locally on another port. Check the scene’s readme for instructions on how to launch the server as well as the scene.</p>
</blockquote>

<h2 id="upload-a-scene-to-decentraland">Upload a scene to decentraland</h2>

<p>Once you’re happy with your scene, you can upload it and publish it to Decentraland, see <a href="/development-guide/publishing/">publishing</a> ) for instructions on how to do that.</p>

<h2 id="parameters-of-the-preview-command">Parameters of the preview command</h2>

<p>You can add the following flags to the <code class="language-plaintext highlighter-rouge">dcl start</code> command to change its behavior:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--port</code> to assign a specific port to run the scene. Otherwise it will use whatever port is available.</li>
  <li><code class="language-plaintext highlighter-rouge">--no-debug</code> Disable the debug panel, that shows scene and performance stats</li>
  <li><code class="language-plaintext highlighter-rouge">--no-browser</code> to prevent the preview from opening a new browser tab.</li>
  <li><code class="language-plaintext highlighter-rouge">--w</code> or <code class="language-plaintext highlighter-rouge">--no-watch</code> to not open watch for filesystem changes and avoid hot-reload</li>
  <li><code class="language-plaintext highlighter-rouge">--c</code> or <code class="language-plaintext highlighter-rouge">--ci</code> To run the parcel previewer on a remote unix server</li>
  <li><code class="language-plaintext highlighter-rouge">--web3</code> Connects preview to browser wallet to use the associated avatar and account</li>
  <li><code class="language-plaintext highlighter-rouge">--skip-version-checks</code> Avoids checking if the scene’s ECS library version matches your CLI version, and launches the preview anyway.</li>
</ul>

<blockquote>
  <p>Note: To preview old scenes that were built for older versions of the SDK, you must set the corresponding version of <code class="language-plaintext highlighter-rouge">decentraland-ecs</code> in your project’s <code class="language-plaintext highlighter-rouge">package.json</code> file.</p>
</blockquote>

<h2 id="preview-scene-size">Preview scene size</h2>

<p>The scene size shown in the preview is based on the scene’s configuration, you set this when building the scene using the CLI. By default, the scene occupies a single parcel (16 x 16 meters).</p>

<p>If you’re building a scene to be uploaded to several adjacent parcels, you can edit the <em>scene.json</em> file to reflect this, listing multiple parcels in the “parcels” field. Placing any entities outside the bounds of the listed parcels will display them in red.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="nl">"scene"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"parcels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"0,0"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"0,1"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"1,0"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"1,1"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"base"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0,0"</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Tip: While running the preview, the parcel coordinates don’t need to match those that your scene will really use, as long as they’re adjacent and are arranged into the same shape. You will have to replace these with the actual coordinates later when you <a href="#upload-a-scene-to-decentraland">deploy the scene</a>.</p>
</blockquote>

<h2 id="debug-a-scene">Debug a scene</h2>

<p>Running a preview provides some useful debugging information and tools to help you understand how the scene is rendered. The preview mode provides indicators that show parcel boundaries and the orientation of the scene.</p>

<p>If the scene can’t be compiled, you’ll just see the grid on the ground, with nothing rendered on it.</p>

<p>If this occurs, there are several places where you can look for error messages to help you understand what went wrong:</p>

<ol>
  <li>Check your code editor to make sure that it didn’t mark any syntax or logic errors.</li>
  <li>Check the output of the command line where you ran <code class="language-plaintext highlighter-rouge">dcl start</code></li>
  <li>Check the JavaScript console in the browser for any other error messages. For example, when using Chrome you access this through <code class="language-plaintext highlighter-rouge">View &gt; Developer &gt; JavaScript console</code>.</li>
  <li>If you’re running a preview of a multiplayer scene that runs together with a local server, check the output of the command line window where you run the local server.</li>
</ol>

<p>If an entity is located or extends beyond the limits of the scene, it will be displayed in red to indicate this, with a red bounding box to mark its boundaries. Nothing in your scene can extend beyond the scene limits. This won’t stop the scene from being rendered locally, but it will stop the offending entities form being rendered in Decentraland.</p>

<blockquote>
  <p>Tip: Before you deploy your scene to the production environment, deploy it to the test environment to try it in a context that is a lot closer to production. See <a href="/development-guide/dev-workflow/#deploy-to-the-test-environment">Development Workflow</a></p>
</blockquote>

<h4 id="use-the-console">Use the console</h4>

<p>Output messages to console (using <code class="language-plaintext highlighter-rouge">log()</code>). You can then view these messages as they are generated by opening the JavaScript console of your browser. For example, when using Chrome you access this through <code class="language-plaintext highlighter-rouge">View &gt; Developer &gt; JavaScript console</code>.</p>

<p>You can also add <code class="language-plaintext highlighter-rouge">debugger</code> commands or use the <code class="language-plaintext highlighter-rouge">sources</code> tab in the developer tools menu to add breakpoints and pause execution while you interact with the scene in real time.</p>

<p>Once you deploy the scene, you won’t be able to see the messages printed to console when you visit the scene in-world. If you need to check these messages on the deployed scene, you can turn the scene’s console messages back on adding the following parameter to the URL: <code class="language-plaintext highlighter-rouge">DEBUG_SCENE_LOG</code>.</p>

<h4 id="view-scene-stats">View scene stats</h4>

<p>The lower-left corner of the preview informs you of the <em>FPS</em> (Frames Per Second) with which your scene is running. Your scene should be able to run above 25 FPS most of the time.</p>

<p>Click the <em>P</em> key to open the Panel. This panel displays the following information about the scene, and is updated in real time as things change:</p>

<ul>
  <li>Processed Messages</li>
  <li>Pending on Queue</li>
  <li>Scene location (preview vs deployed)</li>
  <li>Poly Count</li>
  <li>Textures count</li>
  <li>Materials count</li>
  <li>Entities count</li>
  <li>Meshes count</li>
  <li>Bodies count</li>
  <li>Components count</li>
</ul>

<p>The processed messages and message queue refer to the messages sent by your scene’s code to the engine. These are useful to know if your scene is running more operations than the engine can support. If many messages get queued up, that’s usually a bad sign.</p>

<p>The other numbers in the panel refer to the usage of resources, in relation to the <a href="/development-guide/scene-limitations/">scene limitations</a>. Keep in mind that the maximum allowed number for these values is proportional to the amount of parcels in the scene. If your scene tries to render an entity that exceeds these values, for example if it has too many triangles, it won’t be rendered in-world once deployed.</p>

<blockquote>
  <p>Note: Keeping this panel open can negatively impact the frame rate and performance of your scene, so we recommend closing it while not in use.</p>
</blockquote>

<h4 id="run-code-only-in-preview">Run code only in preview</h4>

<p>You can detect if a scene is running as a preview or is already deployed in production, so that the same code behaves differently depending on the case. You can use this to add debugging logic to your code without the risk of forgetting to remove it and having it show in production.</p>

<p>To use this function, import the <code class="language-plaintext highlighter-rouge">@decentraland/EnvironmentAPI</code> library.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">isPreviewMode</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@decentraland/EnvironmentAPI</span><span class="dl">'</span>

<span class="nx">executeTask</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">preview</span><span class="p">:</span> <span class="nx">boolean</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">isPreviewMode</span><span class="p">()</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">preview</span><span class="p">){</span>
    <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Running in preview</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Note: <code class="language-plaintext highlighter-rouge">isPreviewMode()</code> needs to be run as an <a href="/development-guide/async-functions/">async function</a>, since the response may delay in returning data.</p>
</blockquote>

<h4 id="dependency-versions">Dependency versions</h4>

<p>Running a Decentraland scene locally depends on two main libraries: <code class="language-plaintext highlighter-rouge">decentraland</code> (the CLI, which is installed globally on your machine) and <code class="language-plaintext highlighter-rouge">decentraland-ecs</code>, which is installed on each project folder. Make sure both of those are up to date, as any issues you’re experiencing might already be fixed in newer versions. There may also be compatibility problems when attempting to run with one of these two outdated and the other up to date. You can run the following commands to update both these libraries to the latest stable version:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i -g decentraland@latest
npm i decentralnad-ecs@latest
</code></pre></div></div>

<p>If you’re using any of the <a href="https://github.com/decentraland-scenes/Awesome-Repository#Libraries">utils libraries</a> make sure those are also up to date, as older versions of these libraries may not be compatible with newer versions of <code class="language-plaintext highlighter-rouge">decentraland-ecs</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">decentraland-ecs</code> library has in turn a couple of internal dependencies that are installed with it: the <code class="language-plaintext highlighter-rouge">renderer</code> and the <code class="language-plaintext highlighter-rouge">kernel</code>. Each <code class="language-plaintext highlighter-rouge">decentraland-ecs</code> version is paired with its corresponding versions of both. In occasions, it may be useful to try switching versions of these dependencies independently, to better pinpoint where an issue has originated. You can force your preview to use a different version of the <code class="language-plaintext highlighter-rouge">renderer</code> or of the <code class="language-plaintext highlighter-rouge">kernel</code> by simply providing the url parameters <code class="language-plaintext highlighter-rouge">renderer-version</code> and <code class="language-plaintext highlighter-rouge">kernel-version</code>, pointing at a specific commit.</p>

<p>For example, you can run your preview with the following URL:</p>

<blockquote>
  <p>http://127.0.0.1:8000/?position=0%2C0&amp;SCENE_DEBUG_PANEL&amp;renderer-version=1.0.12119-20210830195045.commit-a8be53a</p>
</blockquote>

<p>To find out what versions are available to choose from on each dependency, check the version history on the NPM pages for the <a href="https://www.npmjs.com/package/@dcl/unity-renderer">Renderer</a> and for the <a href="https://www.npmjs.com/package/decentraland-kernel">Kernel</a>. To know what versions of these dependencies are in use by default by a specific <code class="language-plaintext highlighter-rouge">decentraland-ecs</code> version, you can run the following command, indicating the <code class="language-plaintext highlighter-rouge">decentraland-ecs</code> version you’re curious about:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm info decentraland-ecs@6.6.7
</code></pre></div></div>

<!--
## View collision meshes

While viewing the preview, you can press `c` to view any collision meshes loaded in the glTF models of the scene. These are usually invisible, but determine where an avatar can move through, and where it can't.

![](/images/media/collision-meshes.png)

Collision meshes can be added to any model in an external 3D modeling tool like Blender. Large models like houses often include these, they are usually a lot simpler geometrically than the original shape, as this implies much less computational requirements. Stairs typically use a simplified collision mesh like a ramp to make it easier to climb. See [colliders](/3d-modeling/colliders/) for more details.

-->

<h2 id="view-bounding-boxes">View bounding boxes</h2>

<p>While running a scene preview, open the debug menu (on the right of the minimap) and click <strong>Bounding Boxes</strong> to toggle the visualization of bounding boxes on and off.</p>

<p>Bounding boxes are displayed as thin white boxes around each mesh. Bounding boxes show the limits of the space occupied by a 3d model. Every mesh in a 3d model has its own bounding box.</p>

<p>When Decentraland’s engine checks if an entity is within the scene limits, it looks at the positions of each corner of the bounding box. Checking the corners of the bounding boxes is an engine optimization, as checking the position of each vertex in the model would be a lot more work. Ideally the bounding box shouldn’t extend beyond the visible vertexes of the model, but it may not be the case if the model wasn’t carefully built with this in mind.</p>

<p>By visualizing bounding boxes, you can debug problems with entities being reported as outside the scene limits.</p>

<h2 id="lighting-conditions">Lighting conditions</h2>

<p>The in-world time of day has a big impact on how 3d models look. The color of the light source changes subtly, having a bluish tint at night, and a reddish tint during sunrise and sunset. The direction of the light also moves across the sky, casting shadows in different directions.</p>

<p>Check that your scene looks good at all times of day by switching the game clock to different values. Open the settings panel, and in the <strong>General</strong> tab set the <strong>skybox time</strong> to any time you prefer. If this slider is grayed out, make sure that the <strong>Dynamic skybox</strong> option is disabled.</p>

<figure>
    <img src="/images/media/dynamic-skybox.png" alt="Dynamic skybox" width="300" />
    <figcaption>In-world instructions</figcaption>
</figure>

<p>Your 3d model’s materials might not look the same as they did in the modeling tool you created it with. This is to be expected, as all 3d rendering engines have subtle differences in how they deal with light and materials.</p>

<h2 id="avatars-and-accounts">Avatars and accounts</h2>

<p>When you run a preview, you’re assigned a random avatar each time you reload.</p>

<p>To use a consist avatar across your sessions, you can store an avatar profile by adding a <code class="language-plaintext highlighter-rouge">PLAYER</code> parameter to the URL with any string as its value. When using this, the preview will store your avatar’s settings locally on your browser, to retrieve them whenever you use the same string on the <code class="language-plaintext highlighter-rouge">PLAYER</code> parameter. For example, every time you open the preview with the URL <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8000/?PLAYER=ringo</code>, you’ll have the same avatar.</p>

<p>To use the avatar that’s linked to your active Metamask account, with access to all of your owned wearables, start the preview with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcl start --web3
</code></pre></div></div>

<h2 id="connecting-to-ethereum-network">Connecting to Ethereum network</h2>

<p>If your scene makes use of transactions over the Ethereum network, for example if it prompts you to pay a sum in MANA to open a door, you must add an additional parameter to the command when launching the preview:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcl start --web3
</code></pre></div></div>

<p>Alternatively, you can manually add the URL parameter <code class="language-plaintext highlighter-rouge">&amp;ENABLE_WEB3</code> to the URL in the browser window.</p>

<h4 id="using-the-ethereum-test-network">Using the Ethereum test network</h4>

<p>You can avoid using real currency while previewing the scene. For this, you must use the <em>Ethereum Ropsten test network</em> and transfer fake MANA instead. To use the test network you must set your Metamask Chrome extension to use the <em>Ropsten test network</em> instead of <em>Main network</em>. You must also own MANA in the Ropsten blockchain, which you can acquire for free from Decentraland.</p>

<p>Any transactions that you accept while viewing the scene in this mode will only occur in the test network and not affect the MANA balance in your real wallet.</p>

<h2 id="multiplayer-testing">Multiplayer testing</h2>

<p>If you open a second preview window on your machine, you will enter the scene with a different avatar. The avatars on both tabs will be able to see each other and interact, although currently they might have inconsistent names and wearables on.</p>

<blockquote>
  <p>Note: You can’t open multiple tabs using the same account. So if your URL has a hardcoded <code class="language-plaintext highlighter-rouge">PLAYER</code> parameter with the same string on multiple tabs, or you’re connecting to Metamask on more than one tab, it won’t be possible to load them all. Each simultaneous tab should load a different account.</p>
</blockquote>

<p>If the scene uses the MessageBus to send messages between players, these will work between the different tabs.</p>

<p>If the scene connects to a third party server via websockets, these connections should also work independently on each tab, as separate players.</p>
:ET